#!/bin/bash
wifi_powersave_default="disable"
wifi_powersave_conf_path=$SNAP_DATA/conf.d/wifi-powersave.conf

switch_wifi_powersave() {
  # See https://developer.gnome.org/libnm/stable/NMSettingWireless.html#NMSettingWirelessPowersave
  # for the meaning of the different values for the wifi.powersave option.
  case $1 in
    enable)
      cat << EOF > $wifi_powersave_conf_path
[connection]
wifi.powersave = 3
EOF
      ;;
    disable)
      cat << EOF > $wifi_powersave_conf_path
[connection]
wifi.powersave = 2
EOF
      ;;
    *)
      echo "WARNING: invalid value '$1' supplied for wifi.powersave configuration option"
      ;;
  esac
}

wifi_powersave="`snapctl get wifi.powersave`"
if [ -n "$wifi_powersave" ]; then
  switch_wifi_powersave $wifi_powersave
else
  snapctl set wifi.powersave=$wifi_powersave_default
  switch_wifi_powersave $wifi_powersave_default
fi
