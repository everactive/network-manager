#!/bin/bash

switch_wifi_powersave() {
  path=$SNAP_DATA/conf.d/wifi-powersave.conf
  # See https://developer.gnome.org/libnm/stable/NMSettingWireless.html#NMSettingWirelessPowersave
  # for the meaning of the different values for the wifi.powersave option.
  case $1 in
    enable)
      cat <<EOF > $path
[connection]
wifi.powersave = 3
EOF
      ;;
    disable)
      cat <<EOF > $path
[connection]
wifi.powersave = 2
EOF
      ;;
    *)
      echo "WARNING: invalid value '$1' supplied for wifi.powersave configuration option"
      ;;
  esac
}

value="`snapctl get wifi.powersave`"
if [ -n "$value" ]; then
  switch_wifi_powersave $value
else
  default="disable"
  snapctl set wifi.powersave=$default
  switch_wifi_powersave $default
fi
