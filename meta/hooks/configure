#!/bin/bash
if ! powermode=$(snapctl get powersave); then
    echo "Powersave value is required"
    echo "You can set it by running the command, for example"
    echo "'snap set network-manager powersave=3'"
    echo "Values can be one of:"
    echo "0 -use the globally configured value"
    echo "1 -don't touch currently configured setting"
    echo "2 -disable Wi-Fi power saving"
    echo "3 -enable Wi-Fi power saving"
    exit 1
fi
if [ ! -e /snap/network-manager/current/usr/bin/nmcli ]; then
    echo "nmcli does not exist yet"
    exit 0
fi

myssid=`/snap/bin/network-manager.nmcli c show --active | grep wireless | awk '{print $1}'`

if [ -n "$myssid" ]; then
  echo "Please configure your wifi's ssid"
  exit 0
fi

/snap/bin/network-manager.nmcli c modify $myssid 802-11-wireless.powersave $powermode
/snap/bin/network-manager.nmcli con up $myssid
